<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Workout Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            min-height: calc(100vh - 40px);
            position: relative;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #764ba2;
            margin-bottom: 30px;
            font-size: 28px;
            text-align: center;
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .movement-list {
            list-style: none;
            margin: 20px 0;
        }

        .movement-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            font-weight: 500;
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .movement-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .movement-name {
            flex: 1;
        }

        .movement-actions {
            display: flex;
            gap: 8px;
        }

        .data-btn, .delete-btn {
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .data-btn {
            background: #667eea;
            color: white;
        }

        .data-btn:hover {
            background: #5a67d8;
            transform: scale(1.05);
        }

        .delete-btn {
            background: #ff4757;
            color: white;
        }

        .delete-btn:hover {
            background: #ff3838;
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-size: 16px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .btn-secondary:hover {
            background: #e0e0e0;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-weight: 500;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .sets-container {
            margin: 20px 0;
        }

        .set-group {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .set-group-title {
            font-weight: 600;
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .set-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e0e0e0;
        }

        .set-info {
            font-size: 15px;
            color: #333;
        }

        .set-number {
            color: #667eea;
            font-weight: 600;
            margin-right: 10px;
        }

        .previous-workout {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .previous-workout-title {
            color: #856404;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .no-data {
            text-align: center;
            color: #999;
            padding: 20px;
            font-style: italic;
        }

        /* Chart styles */
        .chart-container {
            position: relative;
            height: 250px;
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
        }

        canvas {
            max-height: 250px;
        }

        .metric-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .metric-tab {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }

        .metric-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .metric-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.2s ease-in-out;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 25px;
            max-width: 350px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .modal-message {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .modal-buttons.single {
            grid-template-columns: 1fr;
        }

        .modal-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn-danger {
            background: linear-gradient(135deg, #ff4757 0%, #ff3838 100%);
            color: white;
        }

        .modal-btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Screen -->
        <div id="mainScreen" class="screen active">
            <h1>ðŸ’ª Workout Tracker</h1>
            <div id="movementList"></div>
            <button class="btn" onclick="showAddMovementScreen()">Add New Movement</button>
        </div>

        <!-- Add Movement Screen -->
        <div id="addMovementScreen" class="screen">
            <h1>Add Movement</h1>
            <label for="movementName">Movement Name:</label>
            <input type="text" id="movementName" placeholder="e.g., Pull-up, Bench Press" autocomplete="off">
            <button class="btn" onclick="addMovement()">Add Movement</button>
            <button class="btn btn-secondary" onclick="showMainScreen()">Cancel</button>
        </div>

        <!-- Exercise Screen -->
        <div id="exerciseScreen" class="screen">
            <h1 id="exerciseName"></h1>
            
            <div id="previousWorkout"></div>
            
            <div class="input-row">
                <div>
                    <label for="weight">Weight (kgs)</label>
                    <input type="number" id="weight" placeholder="0 for bodyweight" value="0" min="0">
                </div>
                <div>
                    <label for="reps">Reps</label>
                    <input type="number" id="reps" placeholder="Number of reps" min="1">
                </div>
            </div>
            
            <button class="btn" onclick="addSet()">Add Set</button>
            
            <div id="todaySets" class="sets-container"></div>
            
            <button class="btn btn-secondary" onclick="showMainScreen()">Back to Home</button>
        </div>

        <!-- Data Screen -->
        <div id="dataScreen" class="screen">
            <h1 id="dataExerciseName"></h1>
            
            <label for="weightFilter">Weight Filter:</label>
            <select id="weightFilter" onchange="updateChart()"></select>
            
            <div class="metric-tabs">
                <div class="metric-tab active" onclick="switchMetric('max')">Max Reps</div>
                <div class="metric-tab" onclick="switchMetric('total')">Total Reps</div>
            </div>
            
            <div class="chart-container">
                <canvas id="dataChart"></canvas>
            </div>
            
            <button class="btn btn-secondary" onclick="showMainScreen()">Back to Home</button>
        </div>
    </div>

    <!-- Modal -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal">
            <div id="modalTitle" class="modal-title"></div>
            <div id="modalMessage" class="modal-message"></div>
            <div id="modalButtons" class="modal-buttons"></div>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Initialize data from localStorage or create empty structure
        let workoutData = JSON.parse(localStorage.getItem('workoutData')) || {
            movements: [],
            history: {}
        };

        let currentExercise = '';
        let todaysSets = {};
        let currentChart = null;
        let currentMetric = 'max';

        // Modal functions
        function showModal(title, message, buttons) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            
            const buttonsContainer = document.getElementById('modalButtons');
            buttonsContainer.innerHTML = '';
            buttonsContainer.className = buttons.length === 1 ? 'modal-buttons single' : 'modal-buttons';
            
            buttons.forEach(button => {
                const btn = document.createElement('button');
                btn.textContent = button.text;
                btn.className = `modal-btn ${button.class}`;
                btn.onclick = () => {
                    hideModal();
                    if (button.action) button.action();
                };
                buttonsContainer.appendChild(btn);
            });
            
            document.getElementById('modalOverlay').classList.add('active');
        }

        function hideModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        function showAlert(title, message) {
            showModal(title, message, [
                { text: 'OK', class: 'modal-btn-primary' }
            ]);
        }

        function showConfirm(title, message, onConfirm) {
            showModal(title, message, [
                { text: 'Cancel', class: 'modal-btn-secondary' },
                { text: 'Delete', class: 'modal-btn-danger', action: onConfirm }
            ]);
        }

        // Utility function to get today's date string
        function getTodayDate() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        // Screen navigation functions
        function showMainScreen() {
            hideAllScreens();
            document.getElementById('mainScreen').classList.add('active');
            renderMovementList();
            // Reset input fields
            document.getElementById('weight').value = '0';
            document.getElementById('reps').value = '';
        }

        function showAddMovementScreen() {
            hideAllScreens();
            document.getElementById('addMovementScreen').classList.add('active');
            document.getElementById('movementName').value = '';
            document.getElementById('movementName').focus();
        }

        function showExerciseScreen(movementName) {
            hideAllScreens();
            currentExercise = movementName;
            document.getElementById('exerciseScreen').classList.add('active');
            document.getElementById('exerciseName').textContent = movementName;
            
            // Reset input fields when entering exercise screen
            document.getElementById('weight').value = '0';
            document.getElementById('reps').value = '';
            
            // Initialize today's sets for this exercise if not exists
            const today = getTodayDate();
            if (!todaysSets[today]) {
                todaysSets[today] = {};
            }
            if (!todaysSets[today][movementName]) {
                // Check if we already have sets saved for today
                if (workoutData.history[movementName] && workoutData.history[movementName][today]) {
                    // Load existing sets from history
                    todaysSets[today][movementName] = [...workoutData.history[movementName][today]];
                } else {
                    todaysSets[today][movementName] = [];
                }
            }
            
            loadPreviousWorkout(movementName);
            renderTodaysSets();
            
            // Focus on reps input for convenience
            document.getElementById('reps').focus();
        }

        function showDataScreen(movementName) {
            hideAllScreens();
            currentExercise = movementName;
            document.getElementById('dataScreen').classList.add('active');
            document.getElementById('dataExerciseName').textContent = movementName + ' - Data';
            
            // Reset metric selection
            currentMetric = 'max';
            document.querySelectorAll('.metric-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector('.metric-tab').classList.add('active');
            
            loadWeightOptions(movementName);
            updateChart();
        }

        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
        }

        // Movement management functions
        function renderMovementList() {
            const listContainer = document.getElementById('movementList');
            
            if (workoutData.movements.length === 0) {
                listContainer.innerHTML = '<div class="empty-state">No movements added yet.<br>Tap "Add New Movement" to get started!</div>';
            } else {
                listContainer.innerHTML = '<ul class="movement-list">' +
                    workoutData.movements.map(movement => 
                        `<li class="movement-item" onclick="showExerciseScreen('${movement}')">
                            <span class="movement-name">${movement}</span>
                            <div class="movement-actions">
                                <button class="data-btn" onclick="event.stopPropagation(); showDataScreen('${movement}')">Data</button>
                                <button class="delete-btn" onclick="event.stopPropagation(); deleteMovement('${movement}')">Delete</button>
                            </div>
                        </li>`
                    ).join('') +
                    '</ul>';
            }
        }

        function addMovement() {
            const movementName = document.getElementById('movementName').value.trim();
            
            if (!movementName) {
                showAlert('Missing Name', 'Please enter a movement name');
                return;
            }
            
            if (workoutData.movements.includes(movementName)) {
                showAlert('Already Exists', 'This movement already exists in your list');
                return;
            }
            
            workoutData.movements.push(movementName);
            workoutData.movements.sort();
            saveData();
            showMainScreen();
        }

        function deleteMovement(movementName) {
            showConfirm(
                'Delete Movement?',
                `Are you sure you want to delete "${movementName}"? This will also delete all workout history for this movement.`,
                () => {
                    // Remove from movements array
                    const index = workoutData.movements.indexOf(movementName);
                    if (index > -1) {
                        workoutData.movements.splice(index, 1);
                    }
                    
                    // Remove all history for this movement
                    if (workoutData.history[movementName]) {
                        delete workoutData.history[movementName];
                    }
                    
                    // Remove from today's sets if present
                    const today = getTodayDate();
                    if (todaysSets[today] && todaysSets[today][movementName]) {
                        delete todaysSets[today][movementName];
                    }
                    
                    saveData();
                    renderMovementList();
                }
            );
        }

        // Exercise tracking functions
        function addSet() {
            const weight = parseFloat(document.getElementById('weight').value) || 0;
            const reps = parseInt(document.getElementById('reps').value);
            
            if (!reps || reps < 1) {
                showAlert('Missing Reps', 'Please enter the number of reps');
                return;
            }
            
            const today = getTodayDate();
            const setData = {
                weight: weight,
                reps: reps,
                timestamp: new Date().toISOString()
            };
            
            // Add to today's sets
            todaysSets[today][currentExercise].push(setData);
            
            // Also save to permanent history
            if (!workoutData.history[currentExercise]) {
                workoutData.history[currentExercise] = {};
            }
            if (!workoutData.history[currentExercise][today]) {
                workoutData.history[currentExercise][today] = [];
            }
            workoutData.history[currentExercise][today].push(setData);
            
            saveData();
            renderTodaysSets();
            
            // Clear reps input for next set
            document.getElementById('reps').value = '';
            document.getElementById('reps').focus();
        }

        function renderTodaysSets() {
            const today = getTodayDate();
            const sets = todaysSets[today]?.[currentExercise] || [];
            const container = document.getElementById('todaySets');
            
            if (sets.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            // Calculate total reps
            const totalReps = sets.reduce((sum, set) => sum + set.reps, 0);
            
            container.innerHTML = '<div class="set-group">' +
                '<div class="set-group-title">TODAY\'S SETS (Total: ' + totalReps + ' reps)</div>' +
                sets.map((set, index) => {
                    const weightText = set.weight === 0 ? 'Bodyweight' : `${set.weight} kgs`;
                    return `<div class="set-item">
                        <div class="set-info">
                            <span class="set-number">Set ${index + 1}:</span>
                            ${set.reps} reps @ ${weightText}
                        </div>
                    </div>`;
                }).join('') +
                '</div>';
        }

        function loadPreviousWorkout(movementName) {
            const container = document.getElementById('previousWorkout');
            const history = workoutData.history[movementName];
            
            if (!history) {
                container.innerHTML = '';
                return;
            }
            
            // Get the most recent workout date (excluding today)
            const today = getTodayDate();
            const dates = Object.keys(history).filter(date => date !== today).sort().reverse();
            
            if (dates.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const lastDate = dates[0];
            const lastWorkout = history[lastDate];
            
            // Calculate total reps for last workout
            const totalReps = lastWorkout.reduce((sum, set) => sum + set.reps, 0);
            
            const formattedDate = new Date(lastDate + 'T00:00:00').toLocaleDateString('en-US', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            container.innerHTML = '<div class="previous-workout">' +
                `<div class="previous-workout-title">LAST WORKOUT: ${formattedDate} (Total: ${totalReps} reps)</div>` +
                lastWorkout.map((set, index) => {
                    const weightText = set.weight === 0 ? 'Bodyweight' : `${set.weight} kgs`;
                    return `<div class="set-item">
                        <div class="set-info">
                            <span class="set-number">Set ${index + 1}:</span>
                            ${set.reps} reps @ ${weightText}
                        </div>
                    </div>`;
                }).join('') +
                '</div>';
        }

        // Data visualization functions
        function loadWeightOptions(movementName) {
            const history = workoutData.history[movementName];
            const weightSelect = document.getElementById('weightFilter');
            
            if (!history) {
                weightSelect.innerHTML = '<option value="">No data available</option>';
                return;
            }
            
            // Get all unique weights
            const weights = new Set();
            Object.values(history).forEach(dayData => {
                dayData.forEach(set => {
                    weights.add(set.weight);
                });
            });
            
            const sortedWeights = Array.from(weights).sort((a, b) => a - b);
            
            // Find the most recent weight
            const recentDates = Object.keys(history).sort().reverse();
            let mostRecentWeight = 0;
            if (recentDates.length > 0) {
                mostRecentWeight = history[recentDates[0]][0].weight;
            }
            
            weightSelect.innerHTML = sortedWeights.map(weight => {
                const label = weight === 0 ? 'Bodyweight' : `${weight} kgs`;
                const selected = weight === mostRecentWeight ? 'selected' : '';
                return `<option value="${weight}" ${selected}>${label}</option>`;
            }).join('');
        }

        function switchMetric(metric) {
            currentMetric = metric;
            
            // Update tab styling
            document.querySelectorAll('.metric-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateChart();
        }

        function updateChart() {
            const selectedWeight = parseFloat(document.getElementById('weightFilter').value);
            const history = workoutData.history[currentExercise];
            
            if (!history || isNaN(selectedWeight)) {
                if (currentChart) {
                    currentChart.destroy();
                    currentChart = null;
                }
                return;
            }
            
            // Prepare data for the selected weight
            const chartData = [];
            const labels = [];
            
            Object.keys(history).sort().forEach(date => {
                const dayData = history[date].filter(set => set.weight === selectedWeight);
                if (dayData.length > 0) {
                    const formattedDate = new Date(date + 'T00:00:00').toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric'
                    });
                    labels.push(formattedDate);
                    
                    if (currentMetric === 'max') {
                        const maxReps = Math.max(...dayData.map(set => set.reps));
                        chartData.push(maxReps);
                    } else {
                        const totalReps = dayData.reduce((sum, set) => sum + set.reps, 0);
                        chartData.push(totalReps);
                    }
                }
            });
            
            // Destroy existing chart if it exists
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Create new chart
            const ctx = document.getElementById('dataChart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: currentMetric === 'max' ? 'Max Reps' : 'Total Reps',
                        data: chartData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        pointBackgroundColor: '#764ba2',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Data persistence
        function saveData() {
            localStorage.setItem('workoutData', JSON.stringify(workoutData));
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            renderMovementList();
        });

        // Handle enter key in add movement screen
        document.getElementById('movementName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addMovement();
            }
        });

        // Handle enter key in exercise screen
        document.getElementById('reps').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addSet();
            }
        });
    </script>
</body>
</html>